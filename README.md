# Telegram Supabase Bot

–ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç ID –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `objects` –≤ Supabase, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –µ—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å –∑–∞–ø–∏—Å—å –ø—Ä—è–º–æ –∏–∑ Telegram.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ**
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`.
   - –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è `TELEGRAM_BOT_TOKEN`, `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY` (service role key) –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, `SUPABASE_OBJECT_ID_COLUMN`.
   - –ü—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö Telegram –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å `TELEGRAM_PROXY_URL` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `socks5://user:pass@host:port`) –∏ –∑–∞–¥–∞—Ç—å `TELEGRAM_CONNECT_TIMEOUT` (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö).
3. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞**
   ```bash
   python bot.py
   ```

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç

- `/start` –∏–ª–∏ `/menu` ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, inline‚Äë–∫–Ω–æ–ø–∫–∞ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–æ–π ¬´üîç –ù–∞–π—Ç–∏ –æ–±—ä–µ–∫—Ç¬ª.
- `/object` (—Å–∏–Ω–æ–Ω–∏–º—ã `/o`, `/id`) –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ ‚Äî –±–æ—Ç –æ–∂–∏–¥–∞–µ—Ç ID –∏ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å.
- `/app` ‚Äî –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –∫–Ω–æ–ø–∫—É —Å –º–∏–Ω–∏‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –≥–¥–µ –æ–±—ä–µ–∫—Ç—ã –º–æ–∂–Ω–æ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ø–∏—Å–∫–æ–º.
- –õ—é–±–æ–π —Ç–µ–∫—Å—Ç –±–µ–∑ –∫–æ–º–∞–Ω–¥—ã –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –∫–∞–∫ ID –æ–±—ä–µ–∫—Ç–∞.
  - –ë–æ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∑–∞–ø–∏—Å—å `objects` –ø–æ `id` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫—É —Å –∫–ª—é—á–µ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–∫–≤–∞—Ä—Ç–∏—Ä–∞, –¥–æ–º/–ñ–ö, –ª–æ–∫–∞—Ü–∏—è, —É—Å–ª–æ–≤–∏—è, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è). JSON –±–æ–ª—å—à–µ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏.
  - –í —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è Inline‚Äë–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å** –∏ **–£–¥–∞–ª–∏—Ç—å**.
- **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è ¬´–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª –±–æ—Ç –∂–¥—ë—Ç JSON —Å –ø–æ–ª—è–º–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
  - –ü—Ä–∏–º–µ—Ä: `{ "name": "–ù–æ–≤–æ–µ –∏–º—è", "price": 1200 }`.
  - –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç PATCH‚Äë–∑–∞–ø—Ä–æ—Å –≤ Supabase –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é –∑–∞–ø–∏—Å—å.
- **–£–¥–∞–ª–µ–Ω–∏–µ**
  - –ö–Ω–æ–ø–∫–∞ ¬´–£–¥–∞–ª–∏—Ç—å¬ª –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.
  - –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–ø–∏—Å—å —É–¥–∞–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ DELETE‚Äë–∑–∞–ø—Ä–æ—Å.
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ JSON –º–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É ¬´–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª ‚Äî –±–æ—Ç –æ–∂–∏–¥–∞–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π JSON –≤ –æ—Ç–≤–µ—Ç.

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- |
| `TELEGRAM_BOT_TOKEN` | –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –æ—Ç @BotFather. |
| `SUPABASE_URL` | URL –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ Supabase (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://<ref>.supabase.co`). |
| `SUPABASE_SERVICE_ROLE_KEY` | Service role key —Å –ø—Ä–∞–≤–∞–º–∏ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—É `objects`. |
| `SUPABASE_OBJECT_ID_COLUMN` | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –∏—Å–∫–∞—Ç—å –∑–∞–ø–∏—Å—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `id`). |
| `TELEGRAM_PROXY_URL` | –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π HTTP/SOCKS‚Äë–ø—Ä–æ–∫—Å–∏ –¥–ª—è Telegram API. |
| `TELEGRAM_CONNECT_TIMEOUT` | –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö). |
| `TELEGRAM_WEBAPP_URL` | –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ–µ –º–∏–Ω–∏‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://example.com/`). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–Ω–æ–ø–∫–∏ `/app`. |
| `WEBAPP_AUTOSTART` | `true/false`. –ï—Å–ª–∏ `true`, –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–π `uvicorn miniapp_server`. |
| `WEBAPP_HOST` / `WEBAPP_PORT` | –ê–¥—Ä–µ—Å –∏ –ø–æ—Ä—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ `uvicorn`, –∫–æ–≥–¥–∞ –≤–∫–ª—é—á—ë–Ω `WEBAPP_AUTOSTART`. |

## –ú–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (WebApp)

1. **–°–æ–±—Ä–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥/–±–µ–∫–µ–Ω–¥**
   - –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –≤–º–µ—Å—Ç–µ —Å –±–æ—Ç–æ–º: –≤—ã—Å—Ç–∞–≤—å—Ç–µ `WEBAPP_AUTOSTART=true` –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `python bot.py` ‚Äî –±—É–¥–µ—Ç –ø–æ–¥–Ω—è—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π `uvicorn` –Ω–∞ `WEBAPP_HOST:WEBAPP_PORT`.
   - –ò–ª–∏ –≤—Ä—É—á–Ω—É—é: `uvicorn miniapp_server:app --reload --host 0.0.0.0 --port 8000`.
   –°–µ—Ä–≤–µ—Ä —Ä–∞–∑–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑ `webapp/` –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ Supabase —á–µ—Ä–µ–∑ `miniapp_server.py`.
2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å URL**
   - –û–±–Ω–æ–≤–∏—Ç–µ `TELEGRAM_WEBAPP_URL` –≤ `.env` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://your-domain.app/` –∏–ª–∏ `http://localhost:8000/` –¥–ª—è —Ç–µ—Å—Ç–æ–≤).
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞, —á—Ç–æ–±—ã –∫–æ–º–∞–Ω–¥–∞ `/app` –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ –∫–Ω–æ–ø–∫—É —Å –≤–∞—à–∏–º URL.
3. **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –º–∏–Ω–∏‚Äë–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
   - –û—Ä–∞–Ω–∂–µ–≤—ã–π —à–∞–ø–∫–∞ ¬´HAPPINESS CRM¬ª, —Å–ø–∏—Å–æ–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
   - –ü–æ–∏—Å–∫ –ø–æ ID/–∞–¥—Ä–µ—Å—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
   - –í –∫–∞–∂–¥–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ: ID, –∞–¥—Ä–µ—Å, —Ü–µ–Ω–∞, –±–∞–∑–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏. –ö–Ω–æ–ø–∫–∞ ¬´–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç¬ª –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∞ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ).
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –∫–∞–∫ Telegram Web App, –Ω–æ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –∫–∞–∫ –æ–±—ã—á–Ω–∞—è SPA –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

## –î–µ–ø–ª–æ–π –Ω–∞ Railway

Railway –∏—Å–ø–æ–ª—å–∑—É–µ—Ç buildpacks –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å Heroku, –ø–æ—ç—Ç–æ–º—É –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Procfile –∏ —É–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏—é Python. –í—Å—ë —É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ:

- `Procfile` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç `web: python bot.py`, –ø–æ—ç—Ç–æ–º—É Railway –ø–æ–¥–Ω–∏–º–∞–µ—Ç –±–æ—Ç–∞ (–≤–º–µ—Å—Ç–µ —Å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º mini-app —Å–µ—Ä–≤–µ—Ä–æ–º, –µ—Å–ª–∏ `WEBAPP_AUTOSTART=true`).
- `runtime.txt` ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –≤–µ—Ä—Å–∏—é Python (`python-3.11.7`).

### –®–∞–≥–∏

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –≤ Railway –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
2. –í —Ä–∞–∑–¥–µ–ª–µ Variables –∑–∞–¥–∞–π—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `.env` (—Å–º. —Ç–∞–±–ª–∏—Ü—É –≤—ã—à–µ). –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω—É–∂–Ω—ã `TELEGRAM_BOT_TOKEN`, `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY`, `SUPABASE_OBJECT_ID_COLUMN`, `CIAN_API_TOKEN` –∏ `TELEGRAM_WEBAPP_URL`.
3. –î–µ–ø–ª–æ–π –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, Railway –≤—ã–ø–æ–ª–Ω–∏—Ç `pip install -r requirements.txt`, –∑–∞—Ç–µ–º –∫–æ–º–∞–Ω–¥—É –∏–∑ Procfile.
4. –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å—Ç—Ä–æ–∫–∏ `Application started` –∏ `Uvicorn running...` ‚Äî —ç—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –±–æ—Ç –∏ mini-app —Å–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤—ã.

> –í–∞–∂–Ω–æ: Telegram –¥–æ–ø—É—Å–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–±–æ—Ç–∞—é—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ –Ω–∞ –æ–¥–∏–Ω —Ç–æ–∫–µ–Ω. –ï—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ Railway-—Å–µ—Ä–≤–∏—Å, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–µ/–¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, –∏–Ω–∞—á–µ polling –ø–æ–ª—É—á–∏—Ç `409 Conflict`.

## –ü—Ä–æ–≤–µ—Ä–∫–∞

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π ID –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `objects`.
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏: —É—Å–ø–µ—à–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤–∞–ª–∏–¥–Ω—ã–π JSON), –æ—à–∏–±–∫–∞ JSON, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –æ—Ç–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –•—Ä–∞–Ω–∏—Ç–µ –∫–ª—é—á–∏ —Ç–æ–ª—å–∫–æ –≤ `.env` (–Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ñ–∞–π–ª).
- Service role key –≤—ã–¥–∞—ë—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø, –ø–æ—ç—Ç–æ–º—É –Ω–µ –¥–µ–ª–∏—Ç–µ—Å—å –∏–º –ø—É–±–ª–∏—á–Ω–æ –∏ –æ–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É, –≥–¥–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–æ—Ç.
